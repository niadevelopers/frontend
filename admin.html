<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Admin Dashboard</h1>
<button onclick="logout()">Logout</button>
<h2>Add Product</h2>
<form id="productForm">
  <input type="text" id="title" placeholder="Title" required><br>
  <textarea id="description" placeholder="Description"></textarea><br>
  <input type="number" id="price" placeholder="Price" required><br>
  <input type="url" id="fileUrl" placeholder="File URL" required><br>
  <select id="type" required>
    <option value="pdf">PDF</option>
    <option value="txt">TXT</option>
    <option value="video">Video</option>
  </select><br>
  <button type="submit">Add Product</button>
</form>

<h2>Products</h2>
<div id="productsList"></div>

<script>

  const BASE_URL = 'https://backend-6-898a.onrender.com';

const token = localStorage.getItem('adminToken');
if (!token) window.location.href = 'login.html';

const productForm = document.getElementById('productForm');
const productsList = document.getElementById('productsList');

productForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  const product = {
    title: document.getElementById('title').value,
    description: document.getElementById('description').value,
    price: Number(document.getElementById('price').value),
    fileUrl: document.getElementById('fileUrl').value,
    type: document.getElementById('type').value
  };
  const res = await fetch(`${BASE_URL}/api/products`, {
    method: 'POST',
    headers: { 'Content-Type':'application/json', Authorization: 'Bearer '+token },
    body: JSON.stringify(product)
  });
  const data = await res.json();
  if (res.ok) {
    productForm.reset();
    loadProducts();
  } else {
    alert(data.message);
  }
});

async function loadProducts() {
  const res = await fetch(`${BASE_URL}/api/products`);
  const products = await res.json();
  productsList.innerHTML = '';
  products.forEach(p => {
    const div = document.createElement('div');
    div.innerHTML = `
      <h3>${p.title}</h3>
      <p>${p.description}</p>
      <p>KES ${p.price}</p>
      <p>Type: ${p.type}</p>
      <button onclick='editProduct("${p._id}")'>Edit</button>
      <button onclick='deleteProduct("${p._id}")'>Delete</button>
    `;
    productsList.appendChild(div);
  });
}

async function deleteProduct(id) {
  if (!confirm('Delete this product?')) return;
  const res = await fetch(`${BASE_URL}/api/products/${id}`, {
    method: 'DELETE',
    headers: { Authorization: 'Bearer '+token }
  });
  if (res.ok) loadProducts();
}

async function editProduct(id) {
  const title = prompt('New Title:');
  if (!title) return;
  const res = await fetch(`${BASE_URL}/api/products/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type':'application/json', Authorization: 'Bearer '+token },
    body: JSON.stringify({ title })
  });
  if (res.ok) loadProducts();
}

function logout() {
  localStorage.removeItem('adminToken');
  window.location.href = 'login.html';
}

loadProducts();
</script>
</body>
</html>